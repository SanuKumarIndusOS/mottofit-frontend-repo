(this.webpackJsonpmotto=this.webpackJsonpmotto||[]).push([[85],{1025:function(e,n){},1038:function(e,n){},338:function(e,n,t){"use strict";t.r(n),t.d(n,"updatePersonTyping",(function(){return o})),t.d(n,"resetChannelDetails",(function(){return c})),t.d(n,"updateMessagingDetails",(function(){return u})),t.d(n,"updateGlobalMessagingDetails",(function(){return l})),t.d(n,"initClientDispatch",(function(){return d})),t.d(n,"unSubscribeFromChannel",(function(){return p})),t.d(n,"unSubscribeFromClient",(function(){return g}));var a=t(5),i=t(109),r=t(15),s=t(348),o=function(e){return function(n,t){var a=t().messagingReducer,s=a.typingMembers,o=a.currentChannelMembers,c=e.type,u=e.participant.state.identity,l=s,d=(localStorage.getItem("user-id"),o.filter((function(e){return e.userIdenity===u}))[0]||{}),p=(null===d||void 0===d?void 0:d.userName)||u;"typingStarted"===c?s.includes(p)||(l=[].concat(Object(i.a)(s),[p]),n({type:r.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{typingMembers:Object(i.a)(l)}})):"typingEnded"===c&&s.includes(p)&&(l=Object(i.a)(s).filter((function(e){return e!==p})),n({type:r.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{typingMembers:Object(i.a)(l)}}))}},c=function(){return function(e){e({type:r.MessagingActionType.RESET_CHANNEL_DETAILS})}},u=function(e){return function(n){n({type:r.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:e})}},l=function(e){return function(n,t){var a,s,o,c,u=null===e||void 0===e||null===(a=e.channel)||void 0===a?void 0:a.sid,l=null===e||void 0===e||null===(s=e.state)||void 0===s?void 0:s.body,d=null===e||void 0===e||null===(o=e.state)||void 0===o?void 0:o.author,p=t().messagingReducer,g=p.pastSessions,f=p.upcomingSessions,y=p.adminMessages,b=p.invitedSessions,v=p.requestedSessions,m=p.userMessages,T=p.trainerMessages,S=Object(i.a)(g),A=Object(i.a)(f),E=Object(i.a)(b),j=Object(i.a)(y),M=Object(i.a)(v),C=Object(i.a)(m),I=Object(i.a)(T),O=h(S,u,l,d),D=h(A,u,l,d),_=h(M,u,l,d),k=h(E,u,l,d),w={pastSessions:O,upcomingSessions:D,requestedSessions:_,adminMessages:h(j,u,l,d),userMessages:h(C,u,l,d),trainerMessages:h(I,u,l,d),invitedSessions:k},L=document.getElementsByClassName("message_left");null===(c=Object(i.a)(L))||void 0===c||c.forEach((function(e){return null===e||void 0===e?void 0:e.scrollTo(0,0)})),n({type:r.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:w})}},d=function(e,n){return function(t,a){t({type:r.MessagingActionType.UPDATE_CLIENT_INSTANCE,payload:new s.default(t,a,e,n)})}},p=function(){return function(e,n){var t=n().messagingReducer.chatClientInstance;t&&t.unSubscribeChannel()}},g=function(){return function(e,n){var t=n().messagingReducer.chatClientInstance;t&&t.removeChatClient()}},h=function(e,n,t,r){var s=Object(i.a)(e).map((function(e){var i=Object(a.a)({},e);return(null===e||void 0===e?void 0:e.channelId)===n&&(Object.keys(i).includes("message")||(i.message={}),i.message.body=t,i.message.date_updated=(new Date).toISOString(),i.message.from=r),Object(a.a)({},i)}));return s=s.sort((function(e,n){var t,a;return new Date((null===n||void 0===n||null===(t=n.message)||void 0===t?void 0:t.date_updated)||1950)-new Date((null===e||void 0===e||null===(a=e.message)||void 0===a?void 0:a.date_updated)||1950)})),Object(i.a)(s)}},348:function(e,n,t){"use strict";t.r(n),t.d(n,"default",(function(){return y}));var a=t(5),i=t(109),r=t(14),s=t.n(r),o=t(28),c=t(20),u=t(21),l=t(15),d=t(6),p=t(113),g=t(38),h=t(338),f=t(989),y=function(){function e(n,t,r,u){var y=this;Object(c.a)(this,e),this.initClient=Object(o.a)(s.a.mark((function e(){var n,t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.getToken();case 2:return n=e.sent,e.next=5,f.Client.create(n);case 5:t=e.sent,y.client=t,y.handler({type:l.MessagingActionType.INITIALIZE_CLIENT,payload:t}),y.initClientListeners(t);case 9:case"end":return e.stop()}}),e)}))),this.initClientListeners=function(e){e.removeAllListeners(),e.on("messageAdded",function(){var e=Object(o.a)(s.a.mark((function e(n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:y.globalMessage(n);case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),e.on("typingStarted",(function(e){y.onParticipantStartTyping(e)})),e.on("typingEnded",(function(e){y.onParticipantEndedTyping(e)})),e.on("tokenAboutToExpire",Object(o.a)(s.a.mark((function n(){var t;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return y.log("token is about to expire"),n.next=3,y.getToken();case 3:t=n.sent,e.updateToken(t);case 5:case"end":return n.stop()}}),n)})))),e.on("tokenExpired",Object(o.a)(s.a.mark((function n(){var t;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return y.log("token is about to expire"),n.next=3,y.getToken();case 3:t=n.sent,e.updateToken(t);case 5:case"end":return n.stop()}}),n)})))),y.cachedChannelId&&y.joinChannelByID(y.cachedChannelId,!0).catch((function(e){Object(g.Toast)({type:"error",message:e.message||"Error"}),y.callBackFn()}))},this.globalMessage=function(e){Object(h.updateGlobalMessagingDetails)(e)(y.handler,y.getState)},this.joinChannelByID=function(){var e=Object(o.a)(s.a.mark((function e(n){var t,a=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>1&&void 0!==a[1]&&a[1],e.abrupt("return",new Promise(function(){var e=Object(o.a)(s.a.mark((function e(a,i){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t||y.unSubscribeChannel(),y.client){e.next=4;break}return e.abrupt("return",alert("Twilio loading"));case 4:return y.handler({type:l.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{isLoading:!0}}),y.log("Attempting to join ".concat(n," channel")),e.next=8,y.client.getChannelByUniqueName(n);case 8:return r=e.sent,e.next=11,y.joinChannel(r);case 11:return e.next=13,y.onChanelJoined(r);case 13:y.log("Channel joined"),y.activeChannel=r,r.on("messageAdded",function(){var e=Object(o.a)(s.a.mark((function e(n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.onMessagedAdded(n);case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),r.on("typingStarted",(function(e){y.onParticipantStartTyping(e)})),r.on("typingEnded",(function(e){y.onParticipantEndedTyping(e)})),r.on("memberJoined",(function(e){y.onMemberJoined(e)})),r.on("memberLeft",(function(e){y.onMemberLeft(e)})),y.handler({type:l.MessagingActionType.UPDATE_CHANNEL_DETAILS,payload:r}),a(!0),e.next=28;break;case 24:e.prev=24,e.t0=e.catch(0),y.log("Not able to join the channel"),i(e.t0);case 28:case"end":return e.stop()}}),e,null,[[0,24]])})));return function(n,t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.joinChannel=function(){var e=Object(o.a)(s.a.mark((function e(n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("joined"===n.channelState.status){e.next=3;break}return e.next=3,n.join();case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.onChanelJoined=function(){var e=Object(o.a)(s.a.mark((function e(n){var t,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getMessages();case 2:t=e.sent,a=t.items||[],y.handler({type:l.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{activeChannelMessages:Object(i.a)(a),isLoading:!1}});case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.onMessagedAdded=function(e){return e.channel.sid!==y.activeChannel.sid?(console.log(e,"msg","diff channel"),{}):y.handler({type:l.MessagingActionType.UPDATE_MESSAGE_DETAILS,payload:e})},this.onParticipantStartTyping=function(e){var n={type:"typingStarted",participant:e};Object(h.updatePersonTyping)(n)(y.handler,y.getState)},this.onParticipantEndedTyping=function(e){var n={type:"typingEnded",participant:e};Object(h.updatePersonTyping)(n)(y.handler,y.getState)},this.onMemberJoined=function(e){var n=e.state.identity;return y.log("".concat(n," has joined the chat")),y.handler({type:l.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{status:"".concat(n," has joined the chat")}})},this.onMemberLeft=function(e){var n=e.state.identity;return y.log("".concat(n," has left the chat")),y.handler({type:l.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{status:"".concat(n," has left the chat")}})},this.getToken=function(){var e=d.twilioApi.getIdentityToken;return e.id=localStorage.getItem("user-id"),new Promise((function(n,t){Object(p.api)(Object(a.a)({},e)).then((function(e){var t=e.chatToken;n(t)})).catch((function(e){Object(g.Toast)({type:"error",message:e.message||"Error"}),t(e)}))}))},this.unSubscribeChannel=function(){y.activeChannel&&(y.activeChannel.removeAllListeners(),y.activeChannel=null,y.log("Un subscribed from the channel")),Object(h.resetChannelDetails)()(y.handler)},this.removeChatClient=function(){y.client&&(y.client.removeAllListeners(),y.client=null,y.handler({type:l.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{clientData:null}}),y.unSubscribeChannel(),y.log("chat client removed"))},this.getState=t,this.handler=n,this.activeChannel=null,this.client=null,this.cachedChannelId=r,this.callBackFn=u,this.initClient()}return Object(u.a)(e,[{key:"log",value:function(e){console.log("---------".concat(e,"------"))}}]),e}()}}]);