(this.webpackJsonpmotto=this.webpackJsonpmotto||[]).push([[82],{275:function(n,e,t){"use strict";t.r(e),t.d(e,"updatePersonTyping",(function(){return o})),t.d(e,"resetChannelDetails",(function(){return c})),t.d(e,"updateMessagingDetails",(function(){return s})),t.d(e,"initClientDispatch",(function(){return u}));var a=t(83),i=t(13),r=t(284),o=function(n){return function(e,t){var r=t().messagingReducer,o=r.typingMembers,c=r.currentChannelMembers,s=n.type,u=n.participant.state.identity,p=o,l=c.filter((function(n){return n.userIdenity===u}))[0]||{},d=(null===l||void 0===l?void 0:l.userName)||u;"typingStarted"===s?o.includes(d)||(p=[].concat(Object(a.a)(o),[d]),e({type:i.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{typingMembers:Object(a.a)(p)}})):"typingEnded"===s&&o.includes(d)&&(p=Object(a.a)(o).filter((function(n){return n!==d})),e({type:i.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{typingMembers:Object(a.a)(p)}}))}},c=function(){return function(n){n({type:i.MessagingActionType.RESET_CHANNEL_DETAILS})}},s=function(n){return function(e){e({type:i.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:n})}},u=function(){return function(n,e){n({type:i.MessagingActionType.UPDATE_CLIENT_INSTANCE,payload:new r.default(n,e)})}}},284:function(n,e,t){"use strict";t.r(e),t.d(e,"default",(function(){return y}));var a=t(4),i=t(83),r=t(62),o=t.n(r),c=t(87),s=t(22),u=t(23),p=t(13),l=t(16),d=t(85),h=t(40),f=t(275),g=t(825),y=function(){function n(e,t){var r=this;Object(s.a)(this,n),this.initClient=Object(c.a)(o.a.mark((function n(){var e,t;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.getToken();case 2:return e=n.sent,n.next=5,g.Client.create(e);case 5:t=n.sent,r.client=t,r.handler({type:p.MessagingActionType.INITIALIZE_CLIENT,payload:t}),r.initClientListeners(t);case 9:case"end":return n.stop()}}),n)}))),this.initClientListeners=function(n){n.removeAllListeners(),n.on("typingStarted",(function(n){r.onParticipantStartTyping(n)})),n.on("typingEnded",(function(n){r.onParticipantEndedTyping(n)})),n.on("tokenAboutToExpire",Object(c.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.log("token is about to expire"),e.next=3,r.getToken();case 3:t=e.sent,n.updateToken(t);case 5:case"end":return e.stop()}}),e)})))),n.on("tokenExpired",Object(c.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.log("token is about to expire"),e.next=3,r.getToken();case 3:t=e.sent,n.updateToken(t);case 5:case"end":return e.stop()}}),e)}))))},this.joinChannelByID=function(){var n=Object(c.a)(o.a.mark((function n(e){return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise(function(){var n=Object(c.a)(o.a.mark((function n(t,a){var i;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,r.unSubscribeChannel(),r.client){n.next=4;break}return n.abrupt("return",alert("Twilio loading"));case 4:return r.handler({type:p.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{isLoading:!0}}),r.log("Attempting to join ".concat(e," channel")),n.next=8,r.client.getChannelByUniqueName(e);case 8:return i=n.sent,n.next=11,r.joinChannel(i);case 11:return n.next=13,r.onChanelJoined(i);case 13:r.log("Channel joined"),r.activeChannel=i,i.on("messageAdded",function(){var n=Object(c.a)(o.a.mark((function n(e){return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.onMessagedAdded(e);case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),i.on("typingStarted",(function(n){r.onParticipantStartTyping(n)})),i.on("typingEnded",(function(n){r.onParticipantEndedTyping(n)})),i.on("memberJoined",(function(n){r.onMemberJoined(n)})),i.on("memberLeft",(function(n){r.onMemberLeft(n)})),r.handler({type:p.MessagingActionType.UPDATE_CHANNEL_DETAILS,payload:i}),t(!0),n.next=28;break;case 24:n.prev=24,n.t0=n.catch(0),r.log("Not able to join the channel"),a(n.t0);case 28:case"end":return n.stop()}}),n,null,[[0,24]])})));return function(e,t){return n.apply(this,arguments)}}()));case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),this.joinChannel=function(){var n=Object(c.a)(o.a.mark((function n(e){return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("joined"===e.channelState.status){n.next=3;break}return n.next=3,e.join();case 3:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),this.onChanelJoined=function(){var n=Object(c.a)(o.a.mark((function n(e){var t,a;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.getMessages();case 2:t=n.sent,a=t.items||[],r.handler({type:p.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{activeChannelMessages:Object(i.a)(a),isLoading:!1}});case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),this.onMessagedAdded=function(n){return n.channel.sid!==r.activeChannel.sid?(console.log(n,"msg","diff channel"),{}):r.handler({type:p.MessagingActionType.UPDATE_MESSAGE_DETAILS,payload:n})},this.onParticipantStartTyping=function(n){var e={type:"typingStarted",participant:n};Object(f.updatePersonTyping)(e)(r.handler,r.getState)},this.onParticipantEndedTyping=function(n){var e={type:"typingEnded",participant:n};Object(f.updatePersonTyping)(e)(r.handler,r.getState)},this.onMemberJoined=function(n){var e=n.state.identity;return r.log("".concat(e," has joined the chat")),r.handler({type:p.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{status:"".concat(e," has joined the chat")}})},this.onMemberLeft=function(n){var e=n.state.identity;return r.log("".concat(e," has left the chat")),r.handler({type:p.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{status:"".concat(e," has left the chat")}})},this.getToken=function(){var n=l.twilioApi.getIdentityToken;return n.id=localStorage.getItem("user-id"),new Promise((function(e,t){Object(d.api)(Object(a.a)({},n)).then((function(n){var t=n.chatToken;e(t)})).catch((function(n){Object(h.Toast)({type:"error",message:n.message||"Error"}),t(n)}))}))},this.getState=t,this.handler=e,this.activeChannel=null,this.client=null,this.initClient()}return Object(u.a)(n,[{key:"unSubscribeChannel",value:function(){this.activeChannel&&(this.activeChannel.removeAllListeners(),this.activeChannel=null,this.log("Un subscribed from the channel")),Object(f.resetChannelDetails)()(this.handler)}},{key:"removeChatClient",value:function(){this.client&&(this.client.removeAllListeners(),this.client=null,this.handler({type:p.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{clientData:null}}),this.unSubscribeChannel(),this.log("chat client removed"))}},{key:"log",value:function(n){console.log("---------".concat(n,"------"))}}]),n}()},964:function(n,e){},978:function(n,e){}}]);
//# sourceMappingURL=82.370af3e6.chunk.js.map