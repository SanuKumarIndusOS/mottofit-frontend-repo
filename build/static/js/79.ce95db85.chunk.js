(this.webpackJsonpmotto=this.webpackJsonpmotto||[]).push([[79],{1001:function(n,e){},1015:function(n,e){},285:function(n,e,t){"use strict";t.r(e),t.d(e,"updatePersonTyping",(function(){return s})),t.d(e,"resetChannelDetails",(function(){return c})),t.d(e,"updateMessagingDetails",(function(){return u})),t.d(e,"updateGlobalMessagingDetails",(function(){return l})),t.d(e,"initClientDispatch",(function(){return d})),t.d(e,"unSubscribeFromChannel",(function(){return p})),t.d(e,"unSubscribeFromClient",(function(){return g}));var a=t(4),i=t(89),r=t(16),o=t(295),s=function(n){return function(e,t){var a=t().messagingReducer,o=a.typingMembers,s=a.currentChannelMembers,c=n.type,u=n.participant.state.identity,l=o,d=s.filter((function(n){return n.userIdenity===u}))[0]||{},p=(null===d||void 0===d?void 0:d.userName)||u;"typingStarted"===c?o.includes(p)||(l=[].concat(Object(i.a)(o),[p]),e({type:r.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{typingMembers:Object(i.a)(l)}})):"typingEnded"===c&&o.includes(p)&&(l=Object(i.a)(o).filter((function(n){return n!==p})),e({type:r.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{typingMembers:Object(i.a)(l)}}))}},c=function(){return function(n){n({type:r.MessagingActionType.RESET_CHANNEL_DETAILS})}},u=function(n){return function(e){e({type:r.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:n})}},l=function(n){return function(e,t){var a,o,s,c,u=null===n||void 0===n||null===(a=n.channel)||void 0===a?void 0:a.sid,l=null===n||void 0===n||null===(o=n.state)||void 0===o?void 0:o.body,d=null===n||void 0===n||null===(s=n.state)||void 0===s?void 0:s.author,p=t().messagingReducer,g=p.pastSessions,h=p.upcomingSessions,y=p.adminMessages,v=p.invitedSessions,b=Object(i.a)(g),T=Object(i.a)(h),m=Object(i.a)(v),A=Object(i.a)(y),S=f(b,u,l,d),E=f(T,u,l,d),M=f(m,u,l,d),j={pastSessions:S,upcomingSessions:E,adminMessages:f(A,u,l,d),invitedSessions:M},C=document.getElementsByClassName("message_left");null===(c=Object(i.a)(C))||void 0===c||c.forEach((function(n){return null===n||void 0===n?void 0:n.scrollTo(0,0)})),e({type:r.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:j})}},d=function(n){return function(e,t){e({type:r.MessagingActionType.UPDATE_CLIENT_INSTANCE,payload:new o.default(e,t,n)})}},p=function(){return function(n,e){var t=e().messagingReducer.chatClientInstance;t&&t.unSubscribeChannel()}},g=function(){return function(n,e){var t=e().messagingReducer.chatClientInstance;t&&t.removeChatClient()}},f=function(n,e,t,r){var o=Object(i.a)(n).map((function(n){var i=Object(a.a)({},n);return(null===n||void 0===n?void 0:n.channelId)===e&&(i.message.body=t,i.message.date_updated=(new Date).toISOString(),i.message.from=r),Object(a.a)({},i)}));return o=o.sort((function(n,e){var t,a;return new Date((null===e||void 0===e||null===(t=e.message)||void 0===t?void 0:t.date_updated)||1950)-new Date((null===n||void 0===n||null===(a=n.message)||void 0===a?void 0:a.date_updated)||1950)})),Object(i.a)(o)}},295:function(n,e,t){"use strict";t.r(e),t.d(e,"default",(function(){return y}));var a=t(4),i=t(89),r=t(64),o=t.n(r),s=t(93),c=t(21),u=t(22),l=t(16),d=t(15),p=t(91),g=t(31),f=t(285),h=t(964),y=function(){function n(e,t,r){var u=this;Object(c.a)(this,n),this.initClient=Object(s.a)(o.a.mark((function n(){var e,t;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u.getToken();case 2:return e=n.sent,n.next=5,h.Client.create(e);case 5:t=n.sent,u.client=t,u.handler({type:l.MessagingActionType.INITIALIZE_CLIENT,payload:t}),u.initClientListeners(t);case 9:case"end":return n.stop()}}),n)}))),this.initClientListeners=function(n){n.removeAllListeners(),n.on("messageAdded",function(){var n=Object(s.a)(o.a.mark((function n(e){return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:u.globalMessage(e);case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),n.on("typingStarted",(function(n){u.onParticipantStartTyping(n)})),n.on("typingEnded",(function(n){u.onParticipantEndedTyping(n)})),n.on("tokenAboutToExpire",Object(s.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u.log("token is about to expire"),e.next=3,u.getToken();case 3:t=e.sent,n.updateToken(t);case 5:case"end":return e.stop()}}),e)})))),n.on("tokenExpired",Object(s.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u.log("token is about to expire"),e.next=3,u.getToken();case 3:t=e.sent,n.updateToken(t);case 5:case"end":return e.stop()}}),e)}))))},this.globalMessage=function(n){Object(f.updateGlobalMessagingDetails)(n)(u.handler,u.getState)},this.joinChannelByID=function(){var n=Object(s.a)(o.a.mark((function n(e){return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise(function(){var n=Object(s.a)(o.a.mark((function n(t,a){var i;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,u.unSubscribeChannel(),u.client){n.next=4;break}return n.abrupt("return",alert("Twilio loading"));case 4:return u.handler({type:l.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{isLoading:!0}}),u.log("Attempting to join ".concat(e," channel")),n.next=8,u.client.getChannelByUniqueName(e);case 8:return i=n.sent,n.next=11,u.joinChannel(i);case 11:return n.next=13,u.onChanelJoined(i);case 13:u.log("Channel joined"),u.activeChannel=i,i.on("messageAdded",function(){var n=Object(s.a)(o.a.mark((function n(e){return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u.onMessagedAdded(e);case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),i.on("typingStarted",(function(n){u.onParticipantStartTyping(n)})),i.on("typingEnded",(function(n){u.onParticipantEndedTyping(n)})),i.on("memberJoined",(function(n){u.onMemberJoined(n)})),i.on("memberLeft",(function(n){u.onMemberLeft(n)})),u.handler({type:l.MessagingActionType.UPDATE_CHANNEL_DETAILS,payload:i}),t(!0),n.next=28;break;case 24:n.prev=24,n.t0=n.catch(0),u.log("Not able to join the channel"),a(n.t0);case 28:case"end":return n.stop()}}),n,null,[[0,24]])})));return function(e,t){return n.apply(this,arguments)}}()));case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),this.joinChannel=function(){var n=Object(s.a)(o.a.mark((function n(e){return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("joined"===e.channelState.status){n.next=3;break}return n.next=3,e.join();case 3:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),this.onChanelJoined=function(){var n=Object(s.a)(o.a.mark((function n(e){var t,a;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.getMessages();case 2:t=n.sent,a=t.items||[],u.handler({type:l.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{activeChannelMessages:Object(i.a)(a),isLoading:!1}});case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),this.onMessagedAdded=function(n){return n.channel.sid!==u.activeChannel.sid?(console.log(n,"msg","diff channel"),{}):u.handler({type:l.MessagingActionType.UPDATE_MESSAGE_DETAILS,payload:n})},this.onParticipantStartTyping=function(n){var e={type:"typingStarted",participant:n};Object(f.updatePersonTyping)(e)(u.handler,u.getState)},this.onParticipantEndedTyping=function(n){var e={type:"typingEnded",participant:n};Object(f.updatePersonTyping)(e)(u.handler,u.getState)},this.onMemberJoined=function(n){var e=n.state.identity;return u.log("".concat(e," has joined the chat")),u.handler({type:l.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{status:"".concat(e," has joined the chat")}})},this.onMemberLeft=function(n){var e=n.state.identity;return u.log("".concat(e," has left the chat")),u.handler({type:l.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{status:"".concat(e," has left the chat")}})},this.getToken=function(){var n=d.twilioApi.getIdentityToken;return n.id=localStorage.getItem("user-id"),new Promise((function(e,t){Object(p.api)(Object(a.a)({},n)).then((function(n){var t=n.chatToken;e(t)})).catch((function(n){Object(g.Toast)({type:"error",message:n.message||"Error"}),t(n)}))}))},this.unSubscribeChannel=function(){u.activeChannel&&(u.activeChannel.removeAllListeners(),u.activeChannel=null,u.log("Un subscribed from the channel")),Object(f.resetChannelDetails)()(u.handler)},this.removeChatClient=function(){u.client&&(u.client.removeAllListeners(),u.client=null,u.handler({type:l.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{clientData:null}}),u.unSubscribeChannel(),u.log("chat client removed"))},this.getState=t,this.handler=e,this.activeChannel=null,this.client=null,this.callbackApi=r,this.initClient()}return Object(u.a)(n,[{key:"log",value:function(n){console.log("---------".concat(n,"------"))}}]),n}()}}]);