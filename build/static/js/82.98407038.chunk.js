(this.webpackJsonpmotto=this.webpackJsonpmotto||[]).push([[82],{277:function(e,n,t){"use strict";t.r(n),t.d(n,"updatePersonTyping",(function(){return s})),t.d(n,"resetChannelDetails",(function(){return c})),t.d(n,"updateMessagingDetails",(function(){return u})),t.d(n,"updateGlobalMessagingDetails",(function(){return l})),t.d(n,"initClientDispatch",(function(){return d}));var a=t(4),i=t(84),r=t(15),o=t(286),s=function(e){return function(n,t){var a=t().messagingReducer,o=a.typingMembers,s=a.currentChannelMembers,c=e.type,u=e.participant.state.identity,l=o,d=s.filter((function(e){return e.userIdenity===u}))[0]||{},p=(null===d||void 0===d?void 0:d.userName)||u;"typingStarted"===c?o.includes(p)||(l=[].concat(Object(i.a)(o),[p]),n({type:r.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{typingMembers:Object(i.a)(l)}})):"typingEnded"===c&&o.includes(p)&&(l=Object(i.a)(o).filter((function(e){return e!==p})),n({type:r.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{typingMembers:Object(i.a)(l)}}))}},c=function(){return function(e){e({type:r.MessagingActionType.RESET_CHANNEL_DETAILS})}},u=function(e){return function(n){n({type:r.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:e})}},l=function(e){return function(n,t){var a,o,s,c,u=null===e||void 0===e||null===(a=e.channel)||void 0===a?void 0:a.sid,l=null===e||void 0===e||null===(o=e.state)||void 0===o?void 0:o.body,d=null===e||void 0===e||null===(s=e.state)||void 0===s?void 0:s.author,g=t().messagingReducer,h=g.individualMessages,f=g.socialMessages,y=g.adminMessages,v=Object(i.a)(h),b=Object(i.a)(f),T=Object(i.a)(y),A={individualMessages:p(v,u,l,d),socialMessages:p(b,u,l,d),adminMessages:p(T,u,l,d),allMessages:[].concat(Object(i.a)(h),Object(i.a)(f),Object(i.a)(y)).sort((function(e,n){var t,a;return new Date((null===n||void 0===n||null===(t=n.message)||void 0===t?void 0:t.date_updated)||1950)-new Date((null===e||void 0===e||null===(a=e.message)||void 0===a?void 0:a.date_updated)||1950)}))},m=document.getElementsByClassName("message_left");null===(c=Object(i.a)(m))||void 0===c||c.forEach((function(e){return null===e||void 0===e?void 0:e.scrollTo(0,0)})),n({type:r.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:A})}},d=function(e){return function(n,t){n({type:r.MessagingActionType.UPDATE_CLIENT_INSTANCE,payload:new o.default(n,t,e)})}},p=function(e,n,t,r){var o=Object(i.a)(e).map((function(e){var i=Object(a.a)({},e);return(null===e||void 0===e?void 0:e.channelId)===n&&(i.message.body=t,i.message.date_updated=(new Date).toISOString(),i.message.from=r),Object(a.a)({},i)}));return o=o.sort((function(e,n){var t,a;return new Date((null===n||void 0===n||null===(t=n.message)||void 0===t?void 0:t.date_updated)||1950)-new Date((null===e||void 0===e||null===(a=e.message)||void 0===a?void 0:a.date_updated)||1950)})),Object(i.a)(o)}},286:function(e,n,t){"use strict";t.r(n),t.d(n,"default",(function(){return y}));var a=t(4),i=t(84),r=t(63),o=t.n(r),s=t(88),c=t(22),u=t(23),l=t(15),d=t(16),p=t(86),g=t(36),h=t(277),f=t(846),y=function(){function e(n,t,r){var u=this;Object(c.a)(this,e),this.initClient=Object(s.a)(o.a.mark((function e(){var n,t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.getToken();case 2:return n=e.sent,e.next=5,f.Client.create(n);case 5:t=e.sent,u.client=t,u.handler({type:l.MessagingActionType.INITIALIZE_CLIENT,payload:t}),u.initClientListeners(t);case 9:case"end":return e.stop()}}),e)}))),this.initClientListeners=function(e){e.removeAllListeners(),e.on("messageAdded",function(){var e=Object(s.a)(o.a.mark((function e(n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u.globalMessage(n);case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),e.on("typingStarted",(function(e){u.onParticipantStartTyping(e)})),e.on("typingEnded",(function(e){u.onParticipantEndedTyping(e)})),e.on("tokenAboutToExpire",Object(s.a)(o.a.mark((function n(){var t;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return u.log("token is about to expire"),n.next=3,u.getToken();case 3:t=n.sent,e.updateToken(t);case 5:case"end":return n.stop()}}),n)})))),e.on("tokenExpired",Object(s.a)(o.a.mark((function n(){var t;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return u.log("token is about to expire"),n.next=3,u.getToken();case 3:t=n.sent,e.updateToken(t);case 5:case"end":return n.stop()}}),n)}))))},this.globalMessage=function(e){Object(h.updateGlobalMessagingDetails)(e)(u.handler,u.getState)},this.joinChannelByID=function(){var e=Object(s.a)(o.a.mark((function e(n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(o.a.mark((function e(t,a){var i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,u.unSubscribeChannel(),u.client){e.next=4;break}return e.abrupt("return",alert("Twilio loading"));case 4:return u.handler({type:l.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{isLoading:!0}}),u.log("Attempting to join ".concat(n," channel")),e.next=8,u.client.getChannelByUniqueName(n);case 8:return i=e.sent,e.next=11,u.joinChannel(i);case 11:return e.next=13,u.onChanelJoined(i);case 13:u.log("Channel joined"),u.activeChannel=i,i.on("messageAdded",function(){var e=Object(s.a)(o.a.mark((function e(n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.onMessagedAdded(n);case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),i.on("typingStarted",(function(e){u.onParticipantStartTyping(e)})),i.on("typingEnded",(function(e){u.onParticipantEndedTyping(e)})),i.on("memberJoined",(function(e){u.onMemberJoined(e)})),i.on("memberLeft",(function(e){u.onMemberLeft(e)})),u.handler({type:l.MessagingActionType.UPDATE_CHANNEL_DETAILS,payload:i}),t(!0),e.next=28;break;case 24:e.prev=24,e.t0=e.catch(0),u.log("Not able to join the channel"),a(e.t0);case 28:case"end":return e.stop()}}),e,null,[[0,24]])})));return function(n,t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.joinChannel=function(){var e=Object(s.a)(o.a.mark((function e(n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("joined"===n.channelState.status){e.next=3;break}return e.next=3,n.join();case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.onChanelJoined=function(){var e=Object(s.a)(o.a.mark((function e(n){var t,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getMessages();case 2:t=e.sent,a=t.items||[],u.handler({type:l.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{activeChannelMessages:Object(i.a)(a),isLoading:!1}});case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.onMessagedAdded=function(e){return e.channel.sid!==u.activeChannel.sid?(console.log(e,"msg","diff channel"),{}):u.handler({type:l.MessagingActionType.UPDATE_MESSAGE_DETAILS,payload:e})},this.onParticipantStartTyping=function(e){var n={type:"typingStarted",participant:e};Object(h.updatePersonTyping)(n)(u.handler,u.getState)},this.onParticipantEndedTyping=function(e){var n={type:"typingEnded",participant:e};Object(h.updatePersonTyping)(n)(u.handler,u.getState)},this.onMemberJoined=function(e){var n=e.state.identity;return u.log("".concat(n," has joined the chat")),u.handler({type:l.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{status:"".concat(n," has joined the chat")}})},this.onMemberLeft=function(e){var n=e.state.identity;return u.log("".concat(n," has left the chat")),u.handler({type:l.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{status:"".concat(n," has left the chat")}})},this.getToken=function(){var e=d.twilioApi.getIdentityToken;return e.id=localStorage.getItem("user-id"),new Promise((function(n,t){Object(p.api)(Object(a.a)({},e)).then((function(e){var t=e.chatToken;n(t)})).catch((function(e){Object(g.Toast)({type:"error",message:e.message||"Error"}),t(e)}))}))},this.getState=t,this.handler=n,this.activeChannel=null,this.client=null,this.callbackApi=r,this.initClient()}return Object(u.a)(e,[{key:"unSubscribeChannel",value:function(){this.activeChannel&&(this.activeChannel.removeAllListeners(),this.activeChannel=null,this.log("Un subscribed from the channel")),Object(h.resetChannelDetails)()(this.handler)}},{key:"removeChatClient",value:function(){this.client&&(this.client.removeAllListeners(),this.client=null,this.handler({type:l.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{clientData:null}}),this.unSubscribeChannel(),this.log("chat client removed"))}},{key:"log",value:function(e){console.log("---------".concat(e,"------"))}}]),e}()},984:function(e,n){},998:function(e,n){}}]);
//# sourceMappingURL=82.98407038.chunk.js.map