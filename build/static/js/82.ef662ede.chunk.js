(this.webpackJsonpmotto=this.webpackJsonpmotto||[]).push([[82],{277:function(n,e,t){"use strict";t.r(e),t.d(e,"updatePersonTyping",(function(){return c})),t.d(e,"resetChannelDetails",(function(){return o})),t.d(e,"updateMessagingDetails",(function(){return s})),t.d(e,"initClientDispatch",(function(){return u}));var a=t(84),i=t(15),r=t(286),c=function(n){return function(e,t){var r=t().messagingReducer,c=r.typingMembers,o=r.currentChannelMembers,s=n.type,u=n.participant.state.identity,p=c,l=o.filter((function(n){return n.userIdenity===u}))[0]||{},d=(null===l||void 0===l?void 0:l.userName)||u;"typingStarted"===s?c.includes(d)||(p=[].concat(Object(a.a)(c),[d]),e({type:i.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{typingMembers:Object(a.a)(p)}})):"typingEnded"===s&&c.includes(d)&&(p=Object(a.a)(c).filter((function(n){return n!==d})),e({type:i.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{typingMembers:Object(a.a)(p)}}))}},o=function(){return function(n){n({type:i.MessagingActionType.RESET_CHANNEL_DETAILS})}},s=function(n){return function(e){e({type:i.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:n})}},u=function(n){return function(e,t){e({type:i.MessagingActionType.UPDATE_CLIENT_INSTANCE,payload:new r.default(e,t,n)})}}},286:function(n,e,t){"use strict";t.r(e),t.d(e,"default",(function(){return y}));var a=t(4),i=t(84),r=t(63),c=t.n(r),o=t(88),s=t(22),u=t(23),p=t(15),l=t(16),d=t(86),h=t(36),f=t(277),g=t(846),y=function(){function n(e,t,r){var u=this;Object(s.a)(this,n),this.initClient=Object(o.a)(c.a.mark((function n(){var e,t;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u.getToken();case 2:return e=n.sent,n.next=5,g.Client.create(e);case 5:t=n.sent,u.client=t,u.handler({type:p.MessagingActionType.INITIALIZE_CLIENT,payload:t}),u.initClientListeners(t);case 9:case"end":return n.stop()}}),n)}))),this.initClientListeners=function(n){n.removeAllListeners(),n.on("messageAdded",function(){var n=Object(o.a)(c.a.mark((function n(e){return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:u.globalMessage(e);case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),n.on("typingStarted",(function(n){u.onParticipantStartTyping(n)})),n.on("typingEnded",(function(n){u.onParticipantEndedTyping(n)})),n.on("tokenAboutToExpire",Object(o.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u.log("token is about to expire"),e.next=3,u.getToken();case 3:t=e.sent,n.updateToken(t);case 5:case"end":return e.stop()}}),e)})))),n.on("tokenExpired",Object(o.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u.log("token is about to expire"),e.next=3,u.getToken();case 3:t=e.sent,n.updateToken(t);case 5:case"end":return e.stop()}}),e)}))))},this.globalMessage=function(n){u.callbackApi&&u.callbackApi()},this.joinChannelByID=function(){var n=Object(o.a)(c.a.mark((function n(e){return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise(function(){var n=Object(o.a)(c.a.mark((function n(t,a){var i;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,u.unSubscribeChannel(),u.client){n.next=4;break}return n.abrupt("return",alert("Twilio loading"));case 4:return u.handler({type:p.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{isLoading:!0}}),u.log("Attempting to join ".concat(e," channel")),n.next=8,u.client.getChannelByUniqueName(e);case 8:return i=n.sent,n.next=11,u.joinChannel(i);case 11:return n.next=13,u.onChanelJoined(i);case 13:u.log("Channel joined"),u.activeChannel=i,i.on("messageAdded",function(){var n=Object(o.a)(c.a.mark((function n(e){return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u.onMessagedAdded(e);case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),i.on("typingStarted",(function(n){u.onParticipantStartTyping(n)})),i.on("typingEnded",(function(n){u.onParticipantEndedTyping(n)})),i.on("memberJoined",(function(n){u.onMemberJoined(n)})),i.on("memberLeft",(function(n){u.onMemberLeft(n)})),u.handler({type:p.MessagingActionType.UPDATE_CHANNEL_DETAILS,payload:i}),t(!0),n.next=28;break;case 24:n.prev=24,n.t0=n.catch(0),u.log("Not able to join the channel"),a(n.t0);case 28:case"end":return n.stop()}}),n,null,[[0,24]])})));return function(e,t){return n.apply(this,arguments)}}()));case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),this.joinChannel=function(){var n=Object(o.a)(c.a.mark((function n(e){return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("joined"===e.channelState.status){n.next=3;break}return n.next=3,e.join();case 3:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),this.onChanelJoined=function(){var n=Object(o.a)(c.a.mark((function n(e){var t,a;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.getMessages();case 2:t=n.sent,a=t.items||[],u.handler({type:p.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{activeChannelMessages:Object(i.a)(a),isLoading:!1}});case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),this.onMessagedAdded=function(n){return n.channel.sid!==u.activeChannel.sid?(console.log(n,"msg","diff channel"),{}):u.handler({type:p.MessagingActionType.UPDATE_MESSAGE_DETAILS,payload:n})},this.onParticipantStartTyping=function(n){var e={type:"typingStarted",participant:n};Object(f.updatePersonTyping)(e)(u.handler,u.getState)},this.onParticipantEndedTyping=function(n){var e={type:"typingEnded",participant:n};Object(f.updatePersonTyping)(e)(u.handler,u.getState)},this.onMemberJoined=function(n){var e=n.state.identity;return u.log("".concat(e," has joined the chat")),u.handler({type:p.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{status:"".concat(e," has joined the chat")}})},this.onMemberLeft=function(n){var e=n.state.identity;return u.log("".concat(e," has left the chat")),u.handler({type:p.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{status:"".concat(e," has left the chat")}})},this.getToken=function(){var n=l.twilioApi.getIdentityToken;return n.id=localStorage.getItem("user-id"),new Promise((function(e,t){Object(d.api)(Object(a.a)({},n)).then((function(n){var t=n.chatToken;e(t)})).catch((function(n){Object(h.Toast)({type:"error",message:n.message||"Error"}),t(n)}))}))},this.getState=t,this.handler=e,this.activeChannel=null,this.client=null,this.callbackApi=r,this.initClient()}return Object(u.a)(n,[{key:"unSubscribeChannel",value:function(){this.activeChannel&&(this.activeChannel.removeAllListeners(),this.activeChannel=null,this.log("Un subscribed from the channel")),Object(f.resetChannelDetails)()(this.handler)}},{key:"removeChatClient",value:function(){this.client&&(this.client.removeAllListeners(),this.client=null,this.handler({type:p.MessagingActionType.UPDATE_MESSAGING_DETAILS,payload:{clientData:null}}),this.unSubscribeChannel(),this.log("chat client removed"))}},{key:"log",value:function(n){console.log("---------".concat(n,"------"))}}]),n}()},984:function(n,e){},998:function(n,e){}}]);
//# sourceMappingURL=82.ef662ede.chunk.js.map